@use "abstracts/tokens" as *
@use "abstracts/mixins/breakpoints" as breakpoint
@use "abstracts/mixins/middle-dot-separator" as *
@use "abstracts/mixins/icon-mask" as *

.playground
  --playground-height: 800px

  position: relative
  display: flex
  flex-direction: column
  height: var(--playground-height)
  margin-block: $space-base
  padding: $space-none
  background: var(--color-bg-default)
  color: var(--color-fg-default)
  border: $border-width-default solid var(--color-border-default)
  border-radius: $border-radius-default
  box-shadow: var(--box-shadow-floating-legacy)
  font-size: $font-size-sm
  overflow: hidden
  resize: vertical

  @include breakpoint.container-max(lg)
    --playground-height: 1000px

.playground-header
  display: flex
  align-items: center
  justify-content: space-between
  padding: $space-sm $space-md
  background: var(--color-bg-muted)
  color: var(--color-fg-muted)

.playground-brand,
.playground-toolbar
  display: inline-flex
  align-items: center
  gap: $space-sm

.playground-title
  margin: $space-none
  padding-bottom: $space-none !important
  border: none !important
  font-weight: $font-weight-medium
  font-size: $font-size-base
  letter-spacing: 0.2px
  color: var(--color-fg-default)

.window-controls
  display: flex
  align-items: center
  gap: $space-xs

  .window-btn
    .icon-circle-fill
      width: 1em
      height: 1em

    &.close .icon-circle-fill
      fill: var(--color-bg-danger-emphasis)

    &.minimize .icon-circle-fill
      fill: var(--color-bg-attention-emphasis)

    &.maximize .icon-circle-fill
      fill: var(--color-bg-success-emphasis)

.playground-content
  display: flex
  flex: 1
  overflow: hidden
  position: relative

  &::before
    content: ""
    position: absolute
    inset: 0
    background: var(--color-bg-transparent)
    pointer-events: none
    display: none
    z-index: 10

  &.resizing::before
    display: block
    pointer-events: all

.editor-section,
.preview-section
  flex: 1
  display: flex
  flex-direction: column
  overflow: hidden

.editor-tabs,
.preview-tabs
  display: flex

.preview-tabs
  @include breakpoint.container-max(lg)
    border-block-start: none

.editor-panels,
.preview-panels
  flex: 1
  display: flex
  flex-direction: column
  min-height: 0
  overflow: hidden

.editor-panel,
.preview-panel
  display: none
  flex-direction: column
  flex: 1 1 auto
  min-height: 0
  overflow: auto

  &.active
    display: flex

.code-editor
  display: grid
  grid-template-columns: auto 1fr
  flex: 1
  overflow: auto
  scrollbar-width: thin

  .editor-gutters,
  [contenteditable="true"]
    font-family: $font-stack-monospace
    font-size: $font-size-sm
    line-height: $line-height-code

  .editor-gutters
    display: flex
    align-items: center
    position: sticky
    inset-inline-start: 0
    padding-block: $space-sm
    background: var(--color-bg-muted)
    color: var(--color-fg-muted)
    border-right: $border-width-default solid var(--color-border-muted)
    text-align: center
    user-select: none
    z-index: 6

  [contenteditable="true"]
    padding-block: $space-sm
    white-space: pre
    caret-color: var(--color-fg-default)
    border: none
    resize: none
    outline: none
    z-index: 5

    .editor-line
      position: relative
      cursor: text

      &:has(> br:only-child)::before
        position: absolute
        content: "␣"
        opacity: 0.3

    .token-tab
      position: relative
      cursor: text

      &::before
        content: "→"
        position: absolute
        inset-block-start: 50%
        transform: translateY(-50%)
        opacity: 0.4

    .token-space
      position: relative
      cursor: text

      &::before
        content: "·"
        position: absolute
        inset-inline-start: 50%
        inset-block-start: 50%
        transform: translate(-50%, -50%)
        opacity: 0.4

.preview-frame,
.console-output
  flex: 1 1 auto
  min-height: 0
  overflow: auto
  background: var(--color-bg-default)
  border: none
  scrollbar-width: thin

.editor-header,
.preview-header,
.console-header
  display: flex
  align-items: center
  justify-content: flex-end
  gap: $space-sm
  padding: $space-xs $space-md
  background: var(--color-bg-muted)
  color: var(--color-fg-muted)
  border-bottom: $border-width-default solid var(--color-border-muted)
  font-size: $font-size-sm

.console-output
  padding: $space-sm $space-md
  white-space: pre
  font-family: $font-stack-monospace
  font-size: $font-size-xs
  line-height: $line-height-relaxed

.autorun-check-label
  font-weight: $font-weight-base !important
  color: var(--color-fg-muted) !important

.playground-footer,
.editor-footer,
.preview-footer,
.console-footer
  display: flex
  justify-content: space-between
  align-items: center
  padding: $space-xs $space-md
  font-size: $font-size-xs
  background: color-mix(in srgb, var(--color-bg-muted) 50%, transparent 50%)
  border-top: $border-width-default solid var(--color-border-default)
  color: var(--color-fg-muted)

.caret-metadata,
.console-metadata,
.render-metadata
  display: inline-flex
  align-items: center
  user-select: none
  @include middle-dot-separator

$console-levels: (
  log: var(--color-fg-success),
  info: var(--color-fg-accent),
  debug: var(--color-fg-default),
  warn: var(--color-fg-attention),
  error: var(--color-fg-danger)
)

@each $level, $color in $console-levels
  .console-line-#{$level},
  .console-count-#{$level}
    color: #{$color}

.editor-line
  padding-inline: $space-xs
  width: 100%
  height: 1.5rem
  border-block: $border-width-default solid var(--color-border-transparent)
  position: relative

  &.editor-active-line
    border-block-color: var(--color-border-muted)

  &.collapsed
    display: none !important

.editor-gutter
  display: flex
  align-items: center
  flex-direction: column
  flex-shrink: 0
  overflow: hidden
  min-height: 100%
  box-sizing: border-box

  &.hidden
    display: none

  .editor-line
    display: inline-flex
    align-items: center
    justify-content: space-between
    gap: $space-xs

    &.collapsed
      display: none !important

    [data-line-numbers="off"] &
      .line-number
        display: none

  .line-number
    min-width: 3ch

  .fold-marker
    display: flex
    align-items: center
    justify-content: center
    user-select: none

    &.has-marker
      cursor: pointer

      &::after
        pointer-events: none

      &[data-state="expanded"]::after
        content: ""
        @include icon-mask(url("../assets/svg/chevron-down.svg"), $size: 0.875rem)

      &[data-state="collapsed"]::after
        content: ""
        @include icon-mask(url("../assets/svg/chevron-right.svg"), $size: 0.875rem)

  .editor-active-line
    color: var(--color-fg-default)
    font-weight: $font-weight-semi-bold

[contenteditable="true"]
  .editor-line[data-collapsed-lines]::after
    content: " … (+" attr(data-collapsed-lines) " lines)"
    color: hsl(from var(--color-fg-success) h s l / 0.6)
    font-size: 0.9em
    font-style: italic
    pointer-events: none
    user-select: none
