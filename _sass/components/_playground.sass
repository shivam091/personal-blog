@use "abstracts/tokens" as *
@use "abstracts/mixins/breakpoints" as breakpoint
@use "abstracts/mixins/middle-dot-separator" as *

$gutter-min-width: 3rem

.playground
  --playground-height: 800px

  position: relative
  display: flex
  flex-direction: column
  background: var(--color-bg-default)
  margin-block: $space-base
  color: var(--color-fg-default)
  border: $border-width-default solid var(--color-border-default)
  border-radius: $border-radius-default
  box-shadow: var(--box-shadow-floating-legacy)
  font-size: $font-size-sm
  height: var(--playground-height)
  overflow: hidden
  resize: vertical

  @include breakpoint.container-max(lg)
    --playground-height: 1000px

.playground-header
  display: flex
  align-items: center
  justify-content: space-between
  background: var(--color-bg-muted)
  color: var(--color-fg-muted)
  padding: $space-sm $space-md

.playground-brand,
.playground-toolbar
  display: inline-flex
  align-items: center
  gap: $space-sm

.playground-title
  font-weight: $font-weight-medium
  letter-spacing: 0.2px
  color: var(--color-fg-default)
  font-size: $font-size-base
  margin: $space-none
  border: none !important
  padding-bottom: 0 !important

.window-controls
  display: flex
  align-items: center
  gap: $space-xs

  .window-btn
    .icon-circle-fill
      width: 1em
      height: 1em

    &.close .icon-circle-fill
      fill: var(--color-bg-danger-emphasis)

    &.minimize .icon-circle-fill
      fill: var(--color-bg-attention-emphasis)

    &.maximize .icon-circle-fill
      fill: var(--color-bg-success-emphasis)

.playground-content
  flex: 1
  display: flex
  overflow: hidden

  &::before
    content: ""
    position: absolute
    inset: 0
    background: var(--color-bg-transparent)
    pointer-events: none
    display: none
    z-index: 10

  &.resizing
    &::before
      pointer-events: all
      display: block

[data-line-numbers="off"]
  .editor-lines
    display: none

.editor-section,
.preview-section
  flex: 1
  display: flex
  flex-direction: column
  overflow: hidden

.editor-tabs
  display: flex
  border-bottom: $border-width-default solid var(--color-border-default)

.editor-panels
  flex: 1
  display: flex
  flex-direction: column
  min-height: 0
  overflow: hidden

.editor-panel
  display: none
  flex: 1
  overflow: auto

  &.active
    display: flex
    flex-direction: column

.code-editor
  display: grid
  grid-template-columns: minmax($gutter-min-width, auto) 1fr
  overflow: auto
  scrollbar-width: thin
  flex: 1

  .editor-gutters
    display: flex
    align-items: center
    gap: $space-sm
    user-select: none
    position: sticky
    inset-inline-start: 0
    padding-block: $space-sm
    background: var(--color-bg-muted)
    border-right: $border-width-default solid var(--color-border-muted)
    z-index: 6

  .editor-gutter
    display: flex
    align-items: center
    flex-direction: column
    flex-shrink: 0
    box-sizing: border-box
    min-height: 100%
    overflow: hidden

    .editor-active-line
      color: var(--color-fg-default)
      font-weight: $font-weight-semi-bold

  .editor-lines,
  [contenteditable="true"]
    font-family: $font-stack-monospace
    font-size: $font-size-sm
    line-height: $line-height-code

  .editor-lines
    color: var(--color-fg-muted)
    text-align: center
    pointer-events: none

  [contenteditable="true"]
    padding-block: $space-sm
    white-space: pre
    caret-color: var(--color-fg-default)
    border: none
    resize: none
    outline: none
    z-index: 5

  .editor-line
    padding-inline-start: $space-sm
    width: 100%
    height: 1.5rem
    border-block: 1px solid var(--color-border-transparent)

    &.collapsed
      /* Hide the lines within the folding range */
      display: none

  .editor-active-line
    border-block-color: var(--color-border-muted)

  .editor-token-space
    position: relative
    cursor: text

    &::before
      content: "·"
      opacity: 0.4
      position: absolute
      left: 50%
      transform: translateX(-50%)

  .editor-token-tab
    position: relative
    cursor: text

    &::before
      content: "→"
      opacity: 0.4
      position: absolute
      left: 50%
      transform: translateX(-50%)

  .editor-line
    position: relative
    cursor: text

    &:empty::before
      content: "␣"
      opacity: 0.3

.preview-tabs
  display: flex

  @include breakpoint.container-max(lg)
    border-block-start: none

.preview-panels
  flex: 1
  display: flex
  flex-direction: column
  min-height: 0
  overflow: hidden

.preview-panel
  flex: 1 1 auto
  display: none
  min-height: 0
  overflow: auto

  &.active
    display: flex
    flex-direction: column

  .preview-frame,
  .console-output
    flex: 1 1 auto
    border: none
    background: var(--color-bg-default)
    min-height: 0
    overflow: auto
    scrollbar-width: thin

.editor-header,
.preview-header,
.console-header
  display: flex
  align-items: center
  justify-content: flex-end
  gap: $space-sm
  padding: $space-xs $space-md
  background: var(--color-bg-muted)
  color: var(--color-fg-muted)
  border-bottom: $border-width-default solid var(--color-border-muted)
  font-size: $font-size-sm

.console-output
  padding: $space-sm $space-md
  font-family: $font-stack-monospace
  font-size: $font-size-xs
  line-height: $line-height-relaxed
  white-space: pre
  background: var(--color-bg-default)
  min-height: 0
  overflow: auto

.autorun-check-label
  font-weight: $font-weight-base !important
  color: var(--color-fg-muted) !important

.playground-footer,
.editor-footer,
.preview-footer,
.console-footer
  display: flex
  justify-content: space-between
  align-items: center
  padding: $space-xs $space-md
  border-top: $border-width-default solid var(--color-border-default)
  background: color-mix(in srgb, var(--color-bg-muted) 50%, transparent 50%)
  color: var(--color-fg-muted)
  font-size: $font-size-xs

.caret-metadata,
.console-metadata,
.render-metadata
  display: inline-flex
  align-items: center
  user-select: none

  @include middle-dot-separator

.console-line-log,
.console-count-log
  color: var(--color-fg-success)

.console-line-info,
.console-count-info
  color: var(--color-fg-accent)

.console-line-debug,
.console-count-debug
  color: var(--color-fg-default)

.console-line-warn,
.console-count-warn
  color: var(--color-fg-attention)

.console-line-error,
.console-count-error
  color: var(--color-fg-danger)

/* The gutter icon container (assuming it sits in the line number area) */
.editor-fold-line
  height: 1.5rem

  &.foldable-start
    /* Ensure the marker is visible in the gutter */
    position: relative

  .fold-marker
    display: inline-flex
    align-items: center
    justify-content: center
    font-size: 0.875rem
    cursor: pointer
    user-select: none
    color: var(--color-fg-muted)
    font-family: $font-stack-monospace
    transition: color 0.1s

    &:hover
      color: var(--color-fg-default)

    &::before
      /* Default content, e.g., for collapsed state */
      content: "›"

    &[data-state="collapsed"]::before
      content: "›"

    &[data-state="expanded"]::before
      content: "⌄"
