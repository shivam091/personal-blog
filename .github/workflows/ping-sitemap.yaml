name: Ping Sitemap on Search Engines

on:
  schedule:
    - cron: "0 0 * * *"        # Every day midnight at 00:00 UTC (05:30 IST)
  workflow_dispatch:           # Allows manual trigger

jobs:
  ping:
    runs-on: ubuntu-latest
    name: Ping Search Engines
    env:
      SITEMAP_URL: ${{ secrets.SITEMAP_URL }}

    steps:
      - name: Verify sitemap accessibility
        run: |
          echo "üîç Checking sitemap URL..."
          curl -I "$SITEMAP_URL" || (echo "‚ùå Sitemap fetch failed" && exit 1)

      - name: Ping major search engines
        run: |
          set -e
          echo "üì° Pinging sitemap: $SITEMAP_URL"
          echo

          declare -A ENGINES=(
            ["Google"]="https://www.google.com/ping?sitemap=$SITEMAP_URL"
            ["Bing"]="https://www.bing.com/ping?sitemap=$SITEMAP_URL"
            ["Yandex"]="https://yandex.com/ping?sitemap=$SITEMAP_URL"
          )

          for engine in "${!ENGINES[@]}"; do
            url="${ENGINES[$engine]}"
            echo "üîó Pinging $engine ..."
            if curl -s --head --fail "$url" > /dev/null; then
              curl -s "$url" && echo "‚úÖ $engine pinged successfully!"
            else
              echo "‚ö†Ô∏è $engine may not support sitemap ping."
            fi
            echo
          done
